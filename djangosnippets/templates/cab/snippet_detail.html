{% extends "base.html" %}
{% load cab_tags %}
{% load cache %}
{% load ratings_tags %}
{% load safe_markup %}
{% load url from future %}
{% block bodyclass %}snippet-details{% endblock %}
{% block title %}{{ object.title }}{% endblock %}

{% block content_header %}{{ object.title }}{% endblock %}

{% block content %}<div class="columns large-12">
  <dl id="meta">
    <dt>Author:</dt>
    <dd><a href="/users/{{ object.author.username }}/">{{ object.author.username }}</a></dd>
    <dt>Posted:</dt>
    <dd>{{ object.pub_date|date:"F j, Y" }}</dd>
    <dt>Language:</dt>
    <dd><a href="{{ object.language.get_absolute_url }}">{{ object.language.name }}</a></dd>
    <dt>Version:</dt>
    <dd>{{ object.get_version }}</dd>
    <dt>Tags:</dt>
    <dd>{% for tag in object.tags.all %}<a href="{% url "cab_snippet_matches_tag" tag.slug %}">{{ tag.name }}</a> {% endfor %}</dd>
    <dt>Score:</dt>
    <dd>{{ object.rating_score }} (after {{ object.ratings.count }} ratings)</dd>
  </dl>
  <ul id="actions">
    {% ifequal user.id object.author.id %}
      <li><a href="/snippets/{{ object.id }}/edit/"><i class="fa fa-fw fa-pencil"></i><span>Edit</span></a></li>
    {% endifequal %}
    {% if user.is_authenticated %}
      {% if object|is_bookmarked:user %}
        <li><a href="/bookmarks/delete/{{ object.id }}/"><i class="fa fa-star fa-fw"></i><span>Remove bookmark</span></a></li>
      {% else %}
        <li><a href="/bookmarks/add/{{ object.id }}/"><i class="fa fa-star-o fa-fw"></i><span>Bookmark</span></a></li>
      {% endif %}
      {% with object|rating_score:request.user as rating_score %}
        <li><a href="/snippets/{{ object.id }}/rate/?score=up"><i class="fa fa-fw fa-thumbs{% if rating_score != 1 %}-o{% endif %}-up"></i><span>Is useful</span></a></li>
        <li><a href="/snippets/{{ object.id }}/rate/?score=down"><i class="fa fa-fw fa-thumbs{% if rating_score != -1 %}-o{% endif %}-down"></i><span>Is not useful</span></a></li>
      {% endwith %}
    {% endif %}
    <li><a href="{% url "cab_snippet_flag" object.id %}"><i class="fa fa-fw fa-warning"></i><span>Flag this snippet</span></a></li>
    <li><a href="/snippets/{{ object.id }}/download/" type="{{ object.language.mime_type }}"><i class="fa fa-fw fa-arrow-circle-o-down"></i><span>Download</span></a></li>
  </ul>
  <div id="description">{{ object.description_html|safe }}</div>
  {{ object.highlighted_code|safe }}
  <section id="more">
    <h2>More like this</h3>
    {% cache 600 mlt object.pk %}
      <ol>
      {% for related in object|more_like_this:5 %}
      <li><a href="{{ related.object.get_absolute_url }}">{{ related.object.title }}</a> by <a href="/users/{{ related.object.author.username }}/">{{ related.object.author.username }}</a>
        {{ related.object.pub_date|timesince }} ago
      </li>
      {% endfor %}
      </ol>
    {% endcache %}
  </section>
  <section id="comments">
    <h2>Comments</h2>
    {% load comments %}
    {% get_comment_list for object as comment_list %}
    <dl>
    {% for comment in comment_list %}
      <dt id="c{{ comment.id }}"><a href="/users/{{ comment.user.username }}/">{{ comment.user.username }}</a> (on {{ comment.submit_date|date:"F j, Y" }}):</dt>
      <dd>{{ comment.comment|safe_markdown:"safe"|safe }}
      <p><a href="{{ comment.get_absolute_url }}">#</a></p></dd>
    {% endfor %}
    </dl>
    {% render_comment_form for object %}
  </section>
{% endblock %}
{% block sidebar %}{% endblock %}
